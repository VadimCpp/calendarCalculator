<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
    <header class="container-fluid py-5 bg-dark text-white">
        <h1 class="text-center">–ö–∞–ª–µ–Ω–¥–∞—Ä—å-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
    </header>
    <main class="container py-4">
        <h2> –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è </h2>    
        <p> <b> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å </b> <span id="userName"> ... </span> </p>
        <hr>
        <p>
            <button id="authorize-btn" class="button rounded py-2 px-3" disabled="true">–í–æ–π—Ç–∏</button>
            <button id="signout-btn" class="button rounded py-2 px-3" disabled="true">–í—ã–π—Ç–∏</button>
        </p>
    </main>
    
    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>

        function start() {
            /**
             * Init the client first.
             * Then init the model and update UI.
             */
            gapi.client.init({
                'apiKey': 'AIzaSyA-udSmPEWrf2gzxZeqV-dfBLrYnT1Cd5I',
                'clientId': '432393497287-9i1o458ibu2lk00h6h9el7mimhkd8dvq.apps.googleusercontent.com',
                'scope': 'profile',
            }).then(function() {

                gapi.auth2.getAuthInstance().isSignedIn.listen(signinStatusEvent);

                updateAuthButtonPanel();
                updateUserName();

                $('#authorize-btn').click(function() {                
                    gapi.auth2.getAuthInstance().signIn();                                    
                });

                $('#signout-btn').click(function() {                
                    gapi.auth2.getAuthInstance().signOut();
                });
              
            });

            /**
             * Handler.
             * Listen to auth status beeing changed.
             */
            function signinStatusEvent(isSignedIn) {
                updateAuthButtonPanel();
                updateUserName();
            }

            /**
             * UI method.
             * Updates auth button panel.
             */
            function updateAuthButtonPanel() {
                if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
                    $("#authorize-btn").prop('disabled', true);
                    $("#signout-btn").prop('disabled', false);                    
                } else {
                    $("#authorize-btn").prop('disabled', false);
                    $("#signout-btn").prop('disabled', true);
                }
            }

            /**
             * UI method.
             * Updates user name.
             */
            function updateUserName() {
                gapi.client.request({
                    'path': 'https://people.googleapis.com/v1/people/me?requestMask.includeField=person.names',
                }).then(function(response) {
                    $("#userName").text(
                        response.result.names && response.result.names[0] && response.result.names[0].displayName ? 
                        response.result.names[0].displayName : 
                        '–ò–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ ‚òπÔ∏è'
                    );
                }, function(reason) {
                    console.log('Error: ' + reason && reason.result && reason.result.error && reason.result.error.message ? reason.result.error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    $("#userName").text('–ê–Ω–æ–Ω üòé');
                });
            }

        };

        gapi.load('client', start);
    </script>
</body>
</html>
